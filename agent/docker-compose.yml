version: '3.8'

services:
  smartdns-log-agent:
    build: .
    container_name: smartdns-log-agent-${NODE_ID:-1}
    restart: unless-stopped
    environment:
      - NODE_ID=${NODE_ID}
      - NODE_NAME=${NODE_NAME}
      - LOG_FILE=${LOG_FILE:-/var/log/audit/audit.log}
      - CLICKHOUSE_HOST=${CLICKHOUSE_HOST}
      - CLICKHOUSE_PORT=${CLICKHOUSE_PORT:-9000}
      - CLICKHOUSE_DB=${CLICKHOUSE_DB:-smartdns_logs}
      - CLICKHOUSE_USER=${CLICKHOUSE_USER:-default}
      - CLICKHOUSE_PASSWORD=${CLICKHOUSE_PASSWORD}
      - TZ=Asia/Shanghai
    volumes:
      - /var/log/audit:/logs:ro
      - /etc/localtime:/etc/localtime:ro
    network_mode: host
    user: "0:0"